doctype html
html(ng-app="app")
  head
    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width, initial-scale=1")
    title= title
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css")
    link(rel="stylesheet", href="gallery.css")
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css")
    link(rel="stylesheet", href="jquery.fancybox.min.css")
    link(rel="stylesheet", href="main.css")
  
  body#top
    div(class="container-fluid py-3" ng-controller="photoController")
      div.text-center.my-3(ng-if="loading")
        div.spinner-border.text-primary(role="status")
          span.visually-hidden Loading...  
      // Header
      header.collapsible-header.d-flex.flex-column.sticky-top.bg-white.border-bottom.shadow-sm.px-2.py-2(combo-header)
        // First row: Logo, Album, Controls
        div.d-flex.align-items-center.justify-content-between.w-100
          img(src="/favicon.png" alt="Home" width="28" class="me-2")
          h6.mb-0.flex-grow-1.text-truncate {{selectedAlbum.name}}
          div.ms-auto.d-flex.align-items-center.gap-2
            // Search
            div.input-group.input-group-sm.me-2(style="max-width:200px;")
              input.form-control(
                type="text"
                ng-model="searchTag"
                placeholder="Search..."
                ng-keypress="($event.which === 13) && search()"
              )
              button.btn.btn-outline-primary(type="button", ng-click="search()")
                i.fas.fa-search
              button.btn.btn-outline-secondary(type="button", ng-click="clearSearch()")
                i.fas.fa-times

            // File upload button
            button.btn.btn-outline-success.btn-sm.ms-2(
              type="button"
              ng-click="selectUploadFile()"
            )
              i.fas.fa-upload.me-1

            // Album dropdown
            select.form-select.form-select-sm(
              name="albumList"
              ng-options="album.album for album in albums track by album.path"
              ng-model="selectedAlbum"
              ng-change="loadAlbum()"
            )
            // Hamburger menu button
            button.btn.btn-outline-secondary.btn-sm.d-md-none(
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#folderSidebar"
              aria-expanded="false"
              aria-controls="folderSidebar"
            )
              i.fas.fa-bars

        // Pagination Controls
        // Second row: Pagination + Page Info
        div.d-flex.justify-content-between.align-items-center.mt-1.w-100
          button.btn.btn-outline-secondary.btn-sm(
            ng-click="prevPage()"
            ng-disabled="pageId === 0 || loading"
          )
            i.fas.fa-chevron-left.me-1
            | Prev

          input.form-control.form-control-sm.text-center(
            type="number"
            ng-model="numberOfItemsOnPage"
            min="1"
            style="max-width:70px;"
            title="Number of items per page"
          )

          // Page info
          div.small.text-muted
                | Page {{pageId + 1}} of {{totalPages}} ({{totalPhotos}} photos)

          button.btn.btn-outline-secondary.btn-sm(
            ng-click="nextPage()"
            ng-disabled="noMorePhotos || loading"
          )
            | Next
            i.fas.fa-chevron-right.ms-1

        // Third row: Progress Bar
        div.progress.mt-1(style="height: 4px;")
          div.progress-bar.bg-primary(
            role="progressbar"
            ng-style="{'width': ((pageId + 1) / totalPages * 100) + '%'}"
            aria-valuemin="0"
            aria-valuemax="100"
          )

      // Sidebar + Content
      div.row
        // Sidebar for Folders
        aside#folderSidebar.col-md-2.mb-3.collapse.d-md-block(ng-if="folders.length > 0")
          h6.mb-0.flex-grow-1.text-truncate Albums
          ul.list-group.list-group-flush
            li.list-group-item.list-group-item-action(
              ng-repeat="folder in folders"
              ng-click="setAlbum(folder)"
              ng-class="{'active': folder.album == selectedAlbum.album}"
            ) {{folder.album}}

        // Main Content
        main(ng-class="{'col-md-10': folders.length > 0, 'col-12': folders.length == 0}")
          // Gallery Grid
          div.row.g-3
            div.col-sm-6.col-md-4.col-lg-3(ng-repeat="image in photos")
              div.card.shadow-sm.h-100
                a(
                  ng-href="{{image.path}}"
                  data-fancybox="gallery"
                  data-caption="{{image.tags}}"
                  ng-attr-data-type="{{image.isAudio ? 'iframe' : (image.isVideo ? 'video' : (image.isPdf ? 'iframe' : 'image'))}}"
                  ng-attr-data-width="{{image.isVideo ? '640' : undefined}}"
                  ng-attr-data-height="{{image.isVideo ? '360' : undefined}}"
                )
                  figure
                    img.card-img-top(
                      ng-src="{{image.isAudio ? 'music.png' : (image.isVideo ? 'video.png' : (image.isPdf ? 'pdf.png' : '/thumbs?id=' + image.path + '&w=300&h=200'))}}"
                      alt="{{image.tags}}"
                      loading="lazy"
                    )
                    i.overlay-icon(
                      ng-class="{'fas fa-play-circle': image.isAudio || image.isVideo,'fas fa-file-pdf': image.isPdf,'fas fa-search-plus': image.isPhoto}"
                    )
                div.card-body.p-2
                  h6.card-title.mb-1.text-truncate {{image.tags || 'Untitled'}}
                  p.card-text.text-muted.small.mb-0 {{image.album}}
                  button.btn.btn-sm.btn-outline-secondary.mt-2(ng-click="editImageTag(image)")
                    i.fas.fa-edit.me-1
                    | Edit Tags
      button#goTopBtn.btn.btn-primary.rounded-circle.shadow(
        ng-click="scrollToTop()"
        title="Go to top"
      )
        i.fas.fa-arrow-up

    // Scripts
    script(src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.min.js")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.18/angular-ui-router.min.js")
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js")
    script(src="jquery/jquery.min.js")
    script(src="jquery.fancybox.min.js")
    script(src="js/ng-app.js")
    script(src="js/controllers/photoController.js")
    script(src="js/directives/modalDirective.js")
    script(src="js/directives/fileModelDirective.js")
    script(src="js/directives/shrinkHeaderDirective.js")
    script(src="js/services/photoService.js")
    script(src="js/services/modalService.js")
    
